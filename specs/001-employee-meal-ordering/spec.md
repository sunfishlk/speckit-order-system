# Feature Specification: 员工点餐小程序

**Feature Branch**: `001-employee-meal-ordering`  
**Created**: 2025-11-03  
**Status**: Draft  
**Input**: 用户描述："我要做一个员工点餐的小程序，场景如下：行政专员：每天中午需要帮员工统一订午餐，但使用外部平台不便统计和结算。于是您打算为公司打造一个'员工午餐自选小程序'。功能目标：员工可以打开页面查看今日菜品类别（中餐、轻食、饮品等）；点击'加入购物车'即可选餐；购物车能展示所选菜品与合计价格；提交后系统生成员工订餐清单。"

## 上下文摘要

**需求来源**：行政专员业务痛点 - 外部订餐平台不便于公司内部统计和结算  
**影响范围**：前端（小程序界面）、后端（菜品管理、订单处理）  
**依赖关系**：需要每日更新菜品数据（可能依赖外部供应商或内部行政录入）  
**风险提示**：
- 菜品数据实时性（每日更新机制）
- 订单统计汇总的准确性（涉及财务结算）
- 用户权限管理（员工身份验证）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 员工浏览并选购今日菜品 (Priority: P1)

员工打开小程序，查看当天可选的菜品。
菜品按类别展示（中餐、轻食、饮品等），员工可以浏览各类别下的具体菜品和价格。
选中心仪菜品后，点击"加入购物车"按钮，菜品进入购物车。

**为什么是 P1**：这是核心功能，员工能否点餐取决于此流程。没有这个功能，整个小程序无法使用。

**独立测试**：无需其他功能，员工可以完成"浏览菜品 → 加入购物车 → 查看购物车"的完整流程，验证菜品信息展示正确、购物车计算准确。

**Acceptance Scenarios**:

1. **Given** 今日菜品已更新，**When** 员工打开小程序首页，**Then** 展示今日可选的菜品类别（中餐、轻食、饮品等），每个类别至少展示 1 个菜品
2. **Given** 员工在某类别下，**When** 点击某个菜品的"加入购物车"按钮，**Then** 购物车图标显示数量增加，该菜品出现在购物车列表中
3. **Given** 员工已添加多个菜品到购物车，**When** 打开购物车页面，**Then** 显示所有已选菜品的名称、单价、数量，以及合计价格（精确到分）
4. **Given** 员工在购物车页面，**When** 修改某菜品数量或删除菜品，**Then** 合计价格实时更新

---

### User Story 2 - 员工提交订餐订单 (Priority: P2)

员工确认购物车内容无误后，点击"提交订单"按钮。
系统生成订单记录，包含员工信息、菜品清单、总价。
员工收到订单确认提示（如"订单已提交，请等待行政统计"）。

**为什么是 P2**：在 P1 基础上完成交易闭环，但可以先完成 P1 验证选餐逻辑再实现订单提交。

**独立测试**：可以在 P1 完成后独立开发和测试订单提交功能，验证订单数据完整性和提示正确性。

**Acceptance Scenarios**:

1. **Given** 员工购物车中有菜品，**When** 点击"提交订单"按钮，**Then** 系统生成订单记录（包含员工 ID、菜品 ID、数量、总价、提交时间），并展示"订单已提交"成功提示
2. **Given** 员工购物车为空，**When** 尝试提交订单，**Then** 显示"购物车为空，请先选择菜品"提示，阻止提交
3. **Given** 员工已提交订单，**When** 查看订单历史，**Then** 能看到刚提交的订单详情

---

### User Story 3 - 行政查看订餐统计清单 (Priority: P3)

行政专员登录管理后台，查看当天所有员工的订餐清单。
清单按菜品类别或员工分组展示，方便统一下单和结算。
行政可以导出清单（如 Excel 格式）用于财务记账。

**为什么是 P3**：这是管理端功能，员工点餐功能（P1+P2）可以先上线，行政可以通过后台数据库手动查询过渡。

**独立测试**：可以在 P1+P2 完成后单独开发管理后台，验证数据汇总和导出功能。

**Acceptance Scenarios**:

1. **Given** 多名员工已提交今日订单，**When** 行政专员登录管理后台选择今日日期，**Then** 展示当天所有订单的汇总清单（按菜品分组：中餐 10 份、轻食 5 份等）
2. **Given** 行政查看汇总清单，**When** 点击"导出 Excel"按钮，**Then** 下载包含员工姓名、菜品、数量、单价、小计的 Excel 文件
3. **Given** 行政需要查看某员工具体订单，**When** 搜索员工姓名或 ID，**Then** 展示该员工的订单详情

---

### Edge Cases

- **今日菜品未更新**：员工打开小程序时，如果今日菜品数据为空，显示"今日菜品暂未更新，请稍后再试"提示，而非空白页面
- **订单提交失败**：网络异常或服务器错误时，显示"提交失败，请稍后重试"，已选菜品保留在购物车中
- **重复提交订单**：员工在同一天已提交订单后再次尝试提交，系统提示"今日已有订单，如需修改请联系行政"（或允许修改，需明确规则）
- **菜品价格变动**：设置价格锁定时间窗口（如当日上午 10 点前价格锁定）。在截止时间前价格稳定，员工购物车中的价格不受影响；超过截止时间后，购物车自动按最新价格计算，并在提交前明显提示"价格已更新，请确认后提交"
- **员工身份验证失败**：未登录或登录过期时，无法提交订单，需引导重新登录

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须每日展示可选菜品，菜品按类别（中餐、轻食、饮品等）分组展示
- **FR-002**: 每个菜品必须包含：名称、类别、单价（精确到分）、库存状态（如适用）、价格锁定时间（如"上午 10:00 前价格锁定"）
- **FR-003**: 员工必须能够将菜品加入购物车，购物车支持修改数量和删除
- **FR-004**: 购物车必须实时计算并展示合计价格（所有菜品单价 × 数量的总和）
- **FR-005**: 员工必须能够提交订单，系统生成订单记录包含：员工 ID、菜品清单、总价、提交时间
- **FR-006**: 系统必须通过企业微信 OAuth2 登录验证员工身份。员工无需注册，使用企业微信账号授权登录，系统自动获取员工信息（姓名、部门、员工 ID）
- **FR-007**: 行政专员必须能够查看指定日期的所有订单汇总（按菜品或员工分组）
- **FR-008**: 行政专员必须能够导出订单清单为 Excel 格式，包含员工信息、菜品明细、金额统计
- **FR-009**: 系统必须防止购物车为空时提交订单
- **FR-010**: 系统必须处理今日菜品未更新的情况，展示友好提示而非错误页面

### Key Entities

- **员工 (Employee)**: 用户主体，属性包括员工 ID、姓名、部门、联系方式
- **菜品 (MenuItem)**: 可选餐品，属性包括菜品 ID、名称、类别（中餐/轻食/饮品等）、单价、供应日期
- **购物车 (ShoppingCart)**: 临时存储员工选餐数据，属性包括菜品列表（菜品 ID + 数量）、合计金额
- **订单 (Order)**: 提交后的正式记录，属性包括订单 ID、员工 ID、菜品清单、总价、提交时间、状态（已提交/已完成/已取消）
- **订单明细 (OrderItem)**: 订单中的具体菜品，属性包括菜品 ID、数量、单价（提交时价格快照）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 员工从打开小程序到完成选餐提交，整个流程 <2 分钟
- **SC-002**: 购物车价格计算准确率 100%（所有测试场景中无计算误差）
- **SC-003**: 行政专员查看当日订单汇总并导出清单，操作时间 <30 秒
- **SC-004**: 系统支持至少 100 名员工同时在线选餐（如公司规模 100-500 人）
- **SC-005**: 90% 的员工能在首次使用时无需培训完成点餐（界面直观易用）
- **SC-006**: 订单数据完整性 100%（每笔订单包含完整员工和菜品信息，无数据丢失）

## Assumptions

- 员工每日只能提交一次订单（如需修改需联系行政或在截止时间前允许修改）
- 菜品数据由行政专员或系统管理员每日手动/半自动更新
- 菜品价格在每日固定时间（如上午 10:00）前锁定，之后不可修改当日价格
- 订单不涉及在线支付（由公司统一结算，员工可能通过工资扣除或其他方式支付）
- 小程序运行在微信环境，员工通过企业微信登录
- 企业已配置企业微信应用并开放必要权限（获取员工基本信息）
- 菜品库存不实时同步（先到先得模式或无库存限制，需根据实际场景调整）

## Out of Scope

- 在线支付功能（本期不涉及，由公司财务统一结算）
- 菜品评价和评分功能
- 订单配送跟踪（假设由公司行政统一配送到办公区）
- 多门店或多供应商管理（当前仅面向单一公司内部场景）
- 营养分析和热量计算
